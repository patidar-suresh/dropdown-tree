!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):window.DropDownTree=a(jQuery)}(function(a){"use strict";function b(b){if(this.options=a.extend({},this.options),a.extend(this.options,b),!this.options.element)throw"Select element not specified! Provide a select element in options";if(!this.options.data)throw"Data not specified! Provide data in options";this._init()}a.fn.DropDownTree=function(){return this.data("dropDownTree")};var c=function(b){if(b.divElem.is(":visible"))b.hideDropDownDiv();else{b.divElem.height(b.options.height);var c=b.inputElem[0].getBoundingClientRect();b.divElem.css("width",c.width+"px");var e=(j(b.inputElem[0]),b.inputElem.position()),f=e.left,g=e.top+c.height;c.top+b.divElem.height()+c.height>=a(window).height()&&(g=e.top-b.divElem.outerHeight()),b.divElem.css("top",g),b.divElem.css("left",f),b.divElem.show()}},d=function(b,c,d,e,f,g,h){var i=a("<li/>"),j=a("<input/>").attr({type:"checkbox",id:b+"_ec"});g&&j.attr("checked","checked"),i.append(j);var k=a("<label/>"),l=a("<input/>").attr({type:"checkbox",id:b});l.data("value",c),f&&l.attr("checked","checked"),k.append(l);var m=a("<span/>");h&&m.attr("class","multiselect"),k.append(m),i.append(k);var n=a("<label/>").attr("for",b+"_ec").css("width","0px");e&&n.addClass("leaf"),h&&n.addClass("multiselect"),i.append(n);var o=a("<label/>").attr({for:b,class:"desc"});return o.text(d),f&&o.addClass("active"),i.append(o),i},e=function(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)},f=function(b,c,g,h,i,j){var k=a("<ul/>");return a.each(b,function(a,b){var l=!0,m=!1;null!=b[h]&&b[h].length>0&&(l=!1),i.indexOf(b[c])!==-1&&(m=!0);var n=d(e(),b[c],b[g],l,m,!1,j);null!=b[h]&&n.append(f(b[h],c,g,h,i,j)),k.append(n)}),k},g=function(a,b,c,d,e,g,h){a.empty();var i=!1;"yes"===h&&(i=!0),a.append(f(b,c,d,e,g,i))},h=function(b){var c=[];return b.find("label:not([for]) input:checkbox").each(function(){var b=a(this);b.is(":checked")&&c.push(b.parent().next().next().text())}),c},i=function(b){var c=[];return b.find("label:not([for]) input:checkbox").each(function(){var b=a(this);b.is(":checked")&&c.push(b.data("value"))}),c},j=function(a){for(var b=0,c=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)b+=a.offsetLeft-a.scrollLeft,c+=a.offsetTop-a.scrollTop,a=a.offsetParent;return{top:c,left:b}};return b.prototype.options={resize:"none",height:"100",cascadeCheck:"no",multiSelect:"yes",element:null,data:null,textKey:null,valueKey:null,childrenKey:null,selectedValues:[],required:"no",onChange:null},b.prototype.getSelectedTexts=function(){return h(this.divElem)},b.prototype.hideDropDownDiv=function(){this.valueChanged&&this.options.onChange&&this.options.onChange(i(this.divElem)),this.valueChanged=!1,this.divElem.hide()},b.prototype.getSelectedValues=function(){return i(this.divElem)},b.prototype.setSelectedValues=function(b){var c=this;this.divElem.find("label:not([for]) input:checkbox").each(function(){var d=a(this);if(b.indexOf(d.data("value"))!==-1){if(d.prop("checked",!0),d.parent().next().next().addClass("active"),"no"===c.options.multiSelect)return!1}else d.prop("checked",!1),d.parent().next().next().removeClass("active")}),this.showSelectedText()},b.prototype.showSelectedText=function(){var a=h(this.divElem),b="";b=a.length>this.options.maxItemsToDisplay?a.length+" items selected":a.join(", "),this.inputElem.val(b)},b.prototype.loadData=function(a){g(this.divElem,a,this.options.valueKey,this.options.textKey,this.options.childrenKey,this.options.selectedValues,this.options.multiSelect)},b.prototype.clearSelection=function(){this.divElem.find("label:not([for]) input:checkbox").each(function(){var b=a(this);b.prop("checked",!1),b.parent().next().next().removeClass("active")}),this.showSelectedText()},b.prototype.onChange=function(a){this.options.onChange=a},b.prototype._init=function(){var b=a(this.options.element);switch(b.hide(),b.data("dropDownTree",this),this.divElem=a("<div/>").addClass("dropdown-css3-tree"),this.options.resize){case"x":this.divElem.css("resize","horizontal");break;case"y":this.divElem.css("resize","vertical");break;case"both":this.divElem.css("resize","both");break;default:this.divElem.css("resize","none")}b.after(this.divElem),this.inputElem=a("<input/>").attr({type:"text",name:"txtDropDownTree",value:"",autocomplete:"off"}).addClass(b.attr("class")).addClass("dropdown-css3-arrow").css("padding-right","16px"),("yes"===this.options.required||b.prop("required"))&&this.inputElem.attr("required",!0),this.inputElem.attr("name",b.attr("name"));var d=this;this.inputElem.click(function(){c(d)}),this.inputElem.keydown(function(a){var b=window.event?event:a,c=b.ctrlKey||b.metaKey;return!(!c||67!==b.keyCode)}),b.after(this.inputElem),g(this.divElem,this.options.data,this.options.valueKey,this.options.textKey,this.options.childrenKey,this.options.selectedValues,this.options.multiSelect),a(document).mouseup(function(a){d.divElem.is(a.target)||0!==d.divElem.has(a.target).length||d.inputElem.is(a.target)||d.hideDropDownDiv()}),a(window).bind("mousewheel DOMMouseScroll",function(a){d.divElem.is(a.target)||d.hideDropDownDiv()}),this.divElem.delegate("label input:checkbox","change",function(){var b=a(this);if(d.valueChanged=!0,"no"===d.options.multiSelect&&(d.clearSelection(),b.prop("checked",!0),d.hideDropDownDiv()),b.is(":checked")?b.parent().next().next().addClass("active"):b.parent().next().next().removeClass("active"),"yes"===d.options.cascadeCheck&&"yes"===d.options.multiSelect){var c=b.parent().next().next().next();c.find("label:not([for]) input:checkbox").each(function(){b.is(":checked")?(a(this).prop("checked",!0),a(this).parent().next().next().addClass("active")):(a(this).prop("checked",!1),a(this).parent().next().next().removeClass("active"))})}d.showSelectedText()})},b});